<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/code/studyinformix.ec.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v8">
<meta name="syntax" content="esqlc">
<meta name="settings" content="number_lines,use_css,expand_tabs">
<style type="text/css">
<!--
pre { font-family: monospace; color: #f8f8f8; background-color: #0b2f20; }
body { font-family: monospace; color: #f8f8f8; background-color: #0b2f20; }
.lnr { color: #ffff00; }
.Function { color: #ffff00; font-weight: bold; }
.Constant { color: #ffa0a0; }
.Special { color: #ffdead; }
.PreProc { color: #cd5c5c; }
.Type { color: #bdb76b; font-weight: bold; }
.Statement { color: #f0e68c; font-weight: bold; }
.Comment { color: #87ceeb; }
-->
</style>
</head>
<body>
<pre>
<span class="lnr">  1 </span><span class="Comment">/*</span><span class="Comment"> 数据库系统安全主管 (DBSSO)</span>
<span class="lnr">  2 </span><span class="Comment">    控制审计子系统监视的对象以及数据库服务器可执行的操作</span>
<span class="lnr">  3 </span><span class="Comment">审计分析主管 (AAO)</span>
<span class="lnr">  4 </span><span class="Comment">    控制审计是否发生、维护审计日志文件和分析</span>
<span class="lnr">  5 </span><span class="Comment">    DBSSO要求审计的那些数据库活动a的审计记录。</span>
<span class="lnr">  6 </span>
<span class="lnr">  7 </span><span class="Comment">必须选择定制安装设置才能启用角色分离。</span>
<span class="lnr">  8 </span>
<span class="lnr">  9 </span>
<span class="lnr"> 10 </span><span class="Comment">安装时未选择“允许安装程序保护路径的安全&quot;，在安装之后的解决方法：</span>
<span class="lnr"> 11 </span><span class="Comment">运行以下命令来生成 secure.sh 脚本：$INFORMIXIDIR/bin/onsecurity -r $INFORMIXDIR</span>
<span class="lnr"> 12 </span><span class="Comment">运行 secure.sh 脚本来保护安装路径的安全：$INFORMIXDIR/tmp/secure.sh</span>
<span class="lnr"> 13 </span>
<span class="lnr"> 14 </span><span class="Comment"> 较新版本jre可能与ids不兼容，可以选择-javahome none来使用ids自带的jre。</span>
<span class="lnr"> 15 </span><span class="Comment">sudo ./ids_install -javahome none </span><span class="Comment">*/</span>
<span class="lnr"> 16 </span>
<span class="lnr"> 17 </span>
<span class="lnr"> 18 </span>
<span class="lnr"> 19 </span>
<span class="lnr"> 20 </span><span class="Comment">/*</span><span class="Comment"> /etc/profile.d/informix.sh中的变量设置：</span><span class="Comment">*/</span>
<span class="lnr"> 21 </span>
<span class="lnr"> 22 </span>INFORMIXDIR<span class="Statement">=/</span>home<span class="Statement">/</span>informix<span class="Statement">/</span>informix
<span class="lnr"> 23 </span>INFORMIXSERVER<span class="Statement">=</span>demo_on
<span class="lnr"> 24 </span>ONCONFIG<span class="Statement">=</span>onconfig<span class="Statement">.</span>demo_on
<span class="lnr"> 25 </span>DBDATE<span class="Statement">=</span>MDY4<span class="Statement">*</span>
<span class="lnr"> 26 </span>LD_LIBRARY_PATH<span class="Statement">=</span>$INFORMIXDIR<span class="Statement">/</span>lib:$INFORMIXDIR<span class="Statement">/</span>lib<span class="Statement">/</span>esql:$LD_LIBRARY_PATH
<span class="lnr"> 27 </span>
<span class="lnr"> 28 </span><span class="Type">export</span> INFORMIXDIR INFORMIXSERVER ONCONFIG LD_LIBRARY_PATH
<span class="lnr"> 29 </span>
<span class="lnr"> 30 </span>PATH<span class="Statement">=</span>$PATH:$INFORMIXDIR<span class="Statement">/</span>bin
<span class="lnr"> 31 </span><span class="Type">export</span> PATH
<span class="lnr"> 32 </span>
<span class="lnr"> 33 </span>
<span class="lnr"> 34 </span><span class="Comment">/*</span>
<span class="lnr"> 35 </span><span class="Comment">根据$INFORMIXDIR/etc/sqlhosts来修改/etc/services文件和/etc/hosts文件。</span>
<span class="lnr"> 36 </span>
<span class="lnr"> 37 </span><span class="Comment">准备 Informix 配置文件：（本人是直接使用的安装过程中选择的demon_on服务器实例。</span>
<span class="lnr"> 38 </span>
<span class="lnr"> 39 </span><span class="Comment">    复制 onconfig.std 模板文件。</span>
<span class="lnr"> 40 </span><span class="Comment">    修改模板文件的副本。 DUMPDIR 参数的缺省值是 $INFORMIXDIR/tmp。如果在配置文件中更改此值，请确保指定计算机上的有效目录。</span>
<span class="lnr"> 41 </span><span class="Comment">    将 ONCONFIG 环境变量设置为定制配置文件的名称。</span>
<span class="lnr"> 42 </span>
<span class="lnr"> 43 </span><span class="Comment">要点： 只有用户 informix 或 root 用户才能初始化数据库服务器。</span>
<span class="lnr"> 44 </span><span class="Comment">数据库服务器至少必须进行一次初始化。 oninit -i</span>
<span class="lnr"> 45 </span><span class="Comment">覆盖现有数据库。不带-i选项则不覆盖。</span>
<span class="lnr"> 46 </span><span class="Comment">*/</span>
<span class="lnr"> 47 </span>
<span class="lnr"> 48 </span><span class="Comment">/*</span><span class="Comment"> 因为esql与C都将'\'作为转义字符，且依次进过esql、c处理。所以如要查找字符串 &quot;\&quot;</span>
<span class="lnr"> 49 </span><span class="Comment"> * （3字节）的话，应当使用 </span><span class="Comment">*/</span>
<span class="lnr"> 50 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="Statement">SELECT</span> col1 <span class="Special">FROM</span> tab1 <span class="Special">WHERE</span> col1 <span class="Statement">=</span> ’<span class="Special">\</span><span class="Constant">&quot;</span><span class="Special">\\\\\&quot;</span><span class="Constant">’;</span>
<span class="lnr"> 51 </span>
<span class="lnr"> 52 </span><span class="Comment">/*</span><span class="Comment"> 默认不允许在字符串类型中加入换行符</span>
<span class="lnr"> 53 </span><span class="Comment"> * 方法1：在ONCONFIG文件中配置ALLOW_NEWLINE</span>
<span class="lnr"> 54 </span><span class="Comment"> * 方法2：如下： </span><span class="Comment">*/</span>
<span class="lnr"> 55 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">EXECUTE</span> procedure <span class="Function">ifx_allow_newline</span><span class="Special">(</span>’t’<span class="Special">);</span>
<span class="lnr"> 56 </span>
<span class="lnr"> 57 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">BEGIN</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 58 </span><span class="Statement">--</span> put host variable declarations here
<span class="lnr"> 59 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">END</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 60 </span>
<span class="lnr"> 61 </span><span class="Comment">/*</span><span class="Comment">　当 DELIMIDENT 设置 YES 时，双引号字符串识别 SQL 标识符。当 DELIMIDENT</span>
<span class="lnr"> 62 </span><span class="Comment"> * 没有设置 YES 时，双引号字符串被当作字符串字面值。</span>
<span class="lnr"> 63 </span><span class="Comment"> *</span>
<span class="lnr"> 64 </span><span class="Comment"> *</span>
<span class="lnr"> 65 </span><span class="Comment"> *  定义宿主变量作为参数。</span>
<span class="lnr"> 66 </span><span class="Comment"> *  ANSI C风格如下： 注意参数之间用逗号。</span>
<span class="lnr"> 67 </span><span class="Comment">*/</span>
<span class="lnr"> 68 </span><span class="Type">int</span> <span class="Statement">*</span> <span class="Function">foo</span><span class="Special">(</span>
<span class="lnr"> 69 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">BEGIN</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 70 </span>PARAMETER <span class="Type">char</span> s<span class="Statement">[</span><span class="Constant">20</span><span class="Statement">],</span>
<span class="lnr"> 71 </span>PARAMETER <span class="Type">int</span> id<span class="Statement">,</span>
<span class="lnr"> 72 </span>PARAMETER <span class="Type">int</span> <span class="Special">(</span><span class="Statement">*</span>f<span class="Special">)</span> <span class="Special">(</span><span class="Type">double</span><span class="Special">)</span>
<span class="lnr"> 73 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">END</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 74 </span><span class="Special">)</span>
<span class="lnr"> 75 </span><span class="Special">{</span>
<span class="lnr"> 76 </span><span class="Statement">select</span> fname <span class="Special">into</span> :s <span class="Special">from</span> customer
<span class="lnr"> 77 </span><span class="Special">where</span> customer_num <span class="Statement">=</span> :id<span class="Special">;</span>
<span class="lnr"> 78 </span>
<span class="lnr"> 79 </span><span class="Comment">/*</span><span class="Comment"> 老C K&amp;R风格 </span><span class="Comment">*/</span>
<span class="lnr"> 80 </span><span class="Function">f</span><span class="Special">(</span>s<span class="Statement">,</span> id<span class="Statement">,</span> s_size<span class="Special">)</span>
<span class="lnr"> 81 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">BEGIN</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 82 </span>PARAMETER <span class="Type">char</span> s<span class="Statement">[</span><span class="Constant">20</span><span class="Statement">]</span><span class="Special">;</span>
<span class="lnr"> 83 </span>PARAMETER <span class="Type">int</span> id<span class="Special">;</span>
<span class="lnr"> 84 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> <span class="PreProc">END</span> <span class="PreProc">DECLARE</span> <span class="PreProc">SECTION</span><span class="Special">;</span>
<span class="lnr"> 85 </span><span class="Type">int</span> s_size<span class="Special">;</span>
<span class="lnr"> 86 </span><span class="Special">{</span>
<span class="lnr"> 87 </span><span class="Statement">select</span> fname <span class="Special">into</span> :s <span class="Special">from</span> customer
<span class="lnr"> 88 </span><span class="Special">where</span> customer_num <span class="Statement">=</span> :id<span class="Special">;</span>
<span class="lnr"> 89 </span>
<span class="lnr"> 90 </span><span class="Comment">/*</span><span class="Comment"> 指示变量不能使用DATETIME型或INTERVAL型。</span><span class="Comment">*/</span>
<span class="lnr"> 91 </span>:hostvar INDICATOR :indvar
<span class="lnr"> 92 </span>:hostvar :indvar
<span class="lnr"> 93 </span>$hostvar $indvar
<span class="lnr"> 94 </span><span class="Comment">/*</span><span class="Comment"> 如果ESQL/C语句对宿主变量返回NULL值，指示变量值设为NULL。</span>
<span class="lnr"> 95 </span><span class="Comment"> *</span>
<span class="lnr"> 96 </span><span class="Comment"> * 如果指示变量值并没有事先定义，使用esql -icheck选项时，ESQL会设置</span>
<span class="lnr"> 97 </span><span class="Comment"> * sqlca.sqlcode值。</span>
<span class="lnr"> 98 </span><span class="Comment"> *</span>
<span class="lnr"> 99 </span><span class="Comment"> * 如果宿主变量使用成功，指示变量设为0。</span>
<span class="lnr">100 </span><span class="Comment"> * 如果值被截短，则指示变量值设为宿主变量的大小，且设置SQLSTATE</span>
<span class="lnr">101 </span><span class="Comment"> * 为&quot;01004&quot;。同时设置SQLWARN1为W</span>
<span class="lnr">102 </span><span class="Comment"> </span><span class="Comment">*/</span>
<span class="lnr">103 </span><span class="Comment">/*</span><span class="Comment"> Make sure to terminate the line of code with a semicolon. Some additional</span>
<span class="lnr">104 </span><span class="Comment">examples follow: ESQL/C头文件不必以.h结尾。</span><span class="Comment">*/</span>
<span class="lnr">105 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> include varchar<span class="Statement">.</span>h<span class="Special">;</span>
<span class="lnr">106 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> include sqlda<span class="Special">;</span>
<span class="lnr">107 </span>$include sqlstype<span class="Special">;</span>
<span class="lnr">108 </span><span class="PreProc">EXEC</span> <span class="PreProc">SQL</span> include <span class="Constant">&quot;C:</span><span class="Special">\a</span><span class="Constant">pps</span><span class="Special">\f</span><span class="Constant">inances</span><span class="Special">\c</span><span class="Constant">redits.h&quot;</span><span class="Special">;</span> <span class="Comment">/*</span><span class="Comment">fullpath头文件用双引号括起来 </span><span class="Comment">*/</span>
<span class="lnr">109 </span>
</pre>
</body>
</html>
